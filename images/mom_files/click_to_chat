(function(global){var util={};var pageLoaded=false;util.onload=function(fn){if("document"in global&&document.readyState==="complete"||pageLoaded)return fn();util.on(global,"load",fn,false)};util.on=function(element,event,fn,capture){if(element.attachEvent)element.attachEvent("on"+event,fn);else if(element.addEventListener)element.addEventListener(event,fn,capture)};var isDev="false"==="true";var host="chat2-i6.ssgocc.com";var public_port=parseInt("80",
10);var public_ssl_port=parseInt("443",10);var encoded_account="{\"ActionOnAcdWaitTimeout\":[],\"checkActiveAgents\":\"false\",\"CCAlgorithm\":\"CIRCULAR\",\"CampaignBotName\":\"\",\"containerId\":\"\",\"InactivityTimeout\":[],\"Priority\":\"\",\"google_bySections\":\"false\",\"triggers\":[],\"QnAMaker\":[],\"created_at\":\"2023-09-11 15:15:59.000\",\"state\":\"1\",\"agentNoAnswerConfig\":{\"enabled\":false},\"google_key\":\"\",\"Tracking\":\"0\",\"AttentionLevels\":[],\"outHours_enabled\":\"false\",\"proxyType\":\"CHAT\",\"valid\":true,\"uid\":\"MK-CHAT-USA-ENG\",\"AnnounceEntry\":\"0\",\"GoChatIfTransfer\":\"0\",\"ScreenRecording\":\"0\",\"ContactManagement\":{\"Enabled\":\"1\",\"MergeCriteria\":\"KEEP_NEW\",\"AutoAddIncomingContact\":\"1\"},\"name\":\"MK-CHAT-USA-ENG\",\"TicketEmitter\":[],\"Token\":\"16E2F7831A0B591889704FE9D95C2233\",\"start_button\":\"app\",\"id\":\"WEBCHAT_mk-chat@mks_MK-CHAT-USA-ENG\",\"accountName\":\"WEBCHAT_mk-chat@mks_MK-CHAT-USA-ENG\",\"window_type\":\"embedded\",\"FlowInformation\":[],\"updated_at\":\"2024-04-16 01:04:15.000\",\"GUI\":{\"window_open_mode\":\"NORMAL\"},\"google_enabled\":\"false\",\"language\":\"en\",\"TweetyAppName\":\"MKENGPRODDEPLOYED202403026\",\"Skills\":[],\"BotsToTransferFromAgent\":[],\"snippet_parameters\":[]}";var account=JSON.parse(encoded_account);var vcc="mks";var campaign_status="inactive";var reasonInactiveCampaign="";function buildAddress(host,public_port,public_ssl_port){if(document.location.protocol==="https:")return"https://"+host+(public_ssl_port!==443?":"+public_ssl_port:"");return"http://"+host+(public_port!==80?":"+
public_port:"")}var address=buildAddress(host,public_port,public_ssl_port);if(!("JSON"in global))(function(){var node=document.createElement("script");node.type="text/javascript";node.async=true;node.src=address+"/scripts/json.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(node,s)})();var mobile=false;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,
4)))mobile=true})(navigator.userAgent||navigator.vendor||window.opera);var MAX_ZINDEX=2147483647;var MIN_ZINDEX=-2147483647;var got_jquery=function($){function addCssRule(rulesKey,scope,rule){try{scope=scope+"_"+rulesKey;var styleTag=document.getElementById("webchatStyleRules_"+rulesKey);var sheet=styleTag.sheet?styleTag.sheet:styleTag.styleSheet;if(sheet.insertRule)sheet.insertRule(scope+" { "+rule+" }",0);else if(sheet.addRule)sheet.addRule(scope,rule,0)}catch(e){}}function readyActiveChat(){var evt=
$.Event("readyActiveChat");$(window).trigger(evt)}function initCssRules(rulesKey){$("#webchatStyleRules_"+rulesKey).remove();$("head").append("<style id='webchatStyleRules_"+rulesKey+"'></style>")}function getAccountId(account){return account.id}function getAccountOutOfHoursProcess(account){return account.FlowInformation&&account.FlowInformation.out_of_schedule&&account.FlowInformation.out_of_schedule.Process}function getAccountWebsite(account){return account.webcallConfig||account}function getAccountToken(account){return getAccountWebsite(account).Token}
function getAccountTweetyAppName(account){return getAccountWebsite(account).TweetyAppName}function getAccountWindowType(account){return getAccountWebsite(account).window_type||"embedded"}function getAccountStartButton(account){return getAccountWebsite(account).start_button}function getAccountContainerId(account){return getAccountWebsite(account).containerId}function getAccountTriggers(account){return getAccountWebsite(account).triggers}function getAccountSnippetParameters(account){return getAccountWebsite(account).snippet_parameters}
function hasAccountGoogle(account){return getAccountWebsite(account).google_enabled==="true"}function getAccountGoogleKey(account){return getAccountWebsite(account).google_key}function getAccountGoogleBySections(account){return getAccountWebsite(account).google_bySections}function hasOutOfHoursAccount(account){return getAccountWebsite(account).outHours_enabled==="true"}function getOutOfHoursAccount(account){return getAccountWebsite(account).outHours_account}function hasToGoChatIfTransfer(account){return getAccountWebsite(account).GoChatIfTransfer===
"1"}function InConcertTriggers(webchat){this.webchat=webchat}InConcertTriggers.prototype.__processTimeTrigger=function(trigger){trigger.validPageSince=trigger.validPageSince||new Date;var diffSeconds=(new Date-trigger.validPageSince)/1E3;return diffSeconds>=trigger.timeout};InConcertTriggers.prototype.__processTrigger=function(trigger,url){if(!trigger.regex.test(url)){trigger.validPageSince=null;return false}switch(trigger.type){case "time":return this.__processTimeTrigger(trigger);default:return false}};
InConcertTriggers.prototype.__processTriggers=function(){var self=this;if(self.processingTriggers)return;self.processingTriggers=true;try{var url=window.location.href;$.each(self.triggers,function(_,trigger){if(self.__processTrigger(trigger,url)){if(trigger.open==="MINIMIZED_CHAT")self.webchat.__showMinimized();else self.webchat.initChat();return false}})}catch(e){}self.processingTriggers=false};InConcertTriggers.prototype.startTriggers=function(){var self=this;self.disableTriggers();self.triggers=
getAccountTriggers(this.webchat.originalAccount)||[];self.processingTriggers=false;$.each(self.triggers,function(_,trigger){trigger.regex=new RegExp(trigger.regex,"i")});this.triggersInterval=window.setInterval(function(){self.__processTriggers()},1E3)};InConcertTriggers.prototype.disableTriggers=function(){if(this.triggersInterval){window.clearInterval(this.triggersInterval);this.triggersInterval=null}};function InConcertServer(webchat){this.webchat=webchat;this.globalUrl=this.__getWebchatUrl()}
InConcertServer.prototype.__getWebchatUrl=function(){var protocol=window.location.protocol||"http:";var host_a=host.split(".");var chatSubdomain=host_a[0];var domain="";for(var i=1;i<host_a.length;i++)domain+="."+host_a[i];var chatSubdomain_a=chatSubdomain.split("-");var subdomain="webchat";for(var i=1;i<chatSubdomain_a.length;i++)subdomain+="-"+chatSubdomain_a[i];var url=protocol+"//"+subdomain+domain;return url};InConcertServer.prototype.getWebcontactUrl=function(){var host_a=host.split(".");var chatSubdomain=
host_a[0];var domain="";for(var i=1;i<host_a.length;i++)domain+="."+host_a[i];var chatSubdomain_a=chatSubdomain.split("-");var subdomain="webcontact";for(var i=1;i<chatSubdomain_a.length;i++)subdomain+="-"+chatSubdomain_a[i];var url="//"+subdomain+domain;return url};InConcertServer.prototype.__get=function(path,global,callback){var self=this;var address=global?self.globalUrl:self.webchat.currentAddress;var url=encodeURI(address+path);$.ajax({url:url,type:"get",dataType:"jsonp",success:function(response){callback(response)},
error:function(){callback(false)}})};InConcertServer.prototype.checkIsCampaignActive=function(callback){callback(campaign_status==="active")};InConcertServer.prototype.getAccountConfiguration=function(campaignId,accountId,callback){this.__get("/resolve_account/"+campaignId+"/"+accountId,true,function(result){callback(result)})};InConcertServer.prototype.checkActiveSession=function(accountId,sessionId,callback){this.__get("/is_session_active?account="+accountId+"&session="+sessionId,true,function(result){callback(result&&
result.active||false)})};function InConcertStorage(webchat){this.webchat=webchat}InConcertStorage.prototype.__set=function(key,value,json,customToken){if(typeof Storage==="undefined")return;if(json)value=JSON.stringify(value);var token=customToken||this.webchat.currentToken;try{localStorage.setItem(token+"_"+key,value)}catch(e){}};InConcertStorage.prototype.__clean=function(key,customToken){this.__set(key,"",false,customToken)};InConcertStorage.prototype.__get=function(key,json,customToken){if(typeof Storage===
"undefined")return null;var token=customToken||this.webchat.currentToken;try{var data=localStorage.getItem(token+"_"+key);if(json&&data)try{data=JSON.parse(data)}catch(e){data=null}return data}catch(e$0){return null}};InConcertStorage.prototype.cleanEnvironment=function(token,transfer){this.__clean("SESSION",token);this.__clean("ARGS",token);this.__clean("MINIMIZED",token);if(transfer)this.__clean("TRANSFER",token)};InConcertStorage.prototype.getSession=function(token){var session=this.__get("SESSION",
false,token);return session};InConcertStorage.prototype.getArgs=function(){var args=this.__get("ARGS",true);return args};InConcertStorage.prototype.getTransfer=function(){return this.__get("TRANSFER",true,this.webchat.originalToken)};InConcertStorage.prototype.setSession=function(data){return this.__set("SESSION",data)};InConcertStorage.prototype.setArgs=function(data){return this.__set("ARGS",data,true)};InConcertStorage.prototype.setTransfer=function(data){return this.__set("TRANSFER",data,true,
this.webchat.originalToken)};InConcertStorage.prototype.getMinimized=function(){return this.__get("MINIMIZED",false,this.webchat.originalToken)==="true"};InConcertStorage.prototype.setMinimized=function(minimized){return this.__set("MINIMIZED",minimized?"true":"false",false,this.webchat.originalToken)};function InConcertEvents(webchat,storage){function guid(){function s4(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+
s4()}this._uuid=guid();this.webchat=webchat;this.storage=storage;this.experimental_ada_features_enabled=false;this.m_responseFunctions={SHOW_MINIMIZED_CHAT_RESPONSE:{callback:null,timeout:2E3,timeoutEvent:null},HIDE_MINIMIZED_CHAT_RESPONSE:{callback:null,timeout:2E3,timeoutEvent:null},SHOW_CHAT_RESPONSE:{callback:null,timeout:2E3,timeoutEvent:null},HIDE_CHAT_RESPONSE:{callback:null,timeout:2E3,timeoutEvent:null},SEND_MESSAGE_TO_APP_RESPONSE:{callback:null,timeout:3E4,timeoutEvent:null}}}InConcertEvents.prototype.__response=
function(event_name,data){var responseEntry=this.m_responseFunctions[event_name];if(responseEntry.timeoutEvent){window.clearTimeout(responseEntry.timeoutEvent);responseEntry.timeoutEvent=null}var responseFunction=responseEntry.callback;responseEntry.callback=null;if(responseFunction)responseFunction(data)};InConcertEvents.prototype.__notify=function(source,event,data){var self=this;var responseEntry=self.m_responseFunctions[event+"_RESPONSE"];if(responseEntry&&responseEntry.callback)responseEntry.timeoutEvent=
window.setTimeout(function(){self.__response(event+"_RESPONSE",null)},responseEntry.timeout);source.postMessage([this._uuid,event,data],"*")};InConcertEvents.prototype.listen=function(){var self=this;function closeChat(){if(self.experimental_ada_features_enabled)restorePageTabIndexs();self.webchat.closeChat()}function restorePageTabIndexs(){var keyboardfocusableElements=document.querySelectorAll("a[href], button, input, textarea, select, details, [tabindex]");keyboardfocusableElements.forEach(function(element){if(element.__tabindex!==
element.tabIndex&&element.tabIndex==-1){element.tabIndex=element.__tabindex;element.__tabindex=undefined}})}function disablePageTabIndexs(){var keyboardfocusableElements=document.querySelectorAll('a[href], button, input, textarea, select, details, [tabindex]:not([tabindex="-1"])');keyboardfocusableElements.forEach(function(element){element.__tabindex=element.tabIndex;element.tabIndex=-1})}function getSession(source){self.__notify(source,"GET_SESSION_RESPONSE",self.storage.getSession())}function getArgs(source){self.__notify(source,
"GET_ARGS_RESPONSE",self.storage.getArgs())}function setSession(session){self.storage.setSession(session)}function setArgs(args){self.storage.setArgs(args)}function setTransfer(transfer){self.storage.setTransfer(transfer);if(self.webchat.__onTransfer)self.webchat.__onTransfer(transfer)}function cleanEnvironment(){self.storage.cleanEnvironment()}function openChat(){if(self.experimental_ada_features_enabled)disablePageTabIndexs();self.webchat.initChat(true)}function minimizeChat(source,dontShowMinimized){self.webchat._minimize(function(){self.__notify(source,
"MINIMIZE_CHAT_RESPONSE",null)},dontShowMinimized)}function fitMinimizedChat(source,configuration){self.webchat.fitMinimizedChat(configuration,function(show){self.__notify(source,"FIT_MINIMIZED_CHAT_RESPONSE",show,true)})}function showMinimizedShadow(){self.webchat.showMinimizedShadow()}function fitChat(configuration){self.webchat.fitChat(configuration)}function newMessage(message){self.webchat.onNewMessage(message)}function changeToken(token){self.webchat.currentToken=token}function transferToInactiveCampaign(account){self.webchat.transferToInactiveCampaign(account)}
function appMessage(source,message){if(!self.webchat.__onAppMessage)return;var callback=message.callback?function(response){self.__notify(source,"APP_MESSAGE_RESPONSE",response)}:null;self.webchat.__onAppMessage(message.data,callback)}function currentForm(form){self.webchat._currentForm=form;switch(form){case "login":if(self.webchat.__onLoginForm)self.webchat.__onLoginForm();break;case "presurvey":if(self.webchat.__onPreSurveyForm)self.webchat.__onPreSurveyForm();break;case "chat":case "webcall":if(self.webchat.__onChatForm)self.webchat.__onChatForm();
break;case "postsurvey":if(self.webchat.__onPostSurveyForm)self.webchat.__onPostSurveyForm();break}}window.addEventListener("message",function(event){if(!$.isArray(event.data))return;if(event.data[0]!==self._uuid)return;var source=event.source;switch(event.data[1]){case "ENABLE_EXPERIMENTAL_ADA_FEATURES":self.experimental_ada_features_enabled=true;self.webchat.experimental_ada_features_enabled=true;return;case "CHANGE_TOKEN":return changeToken(event.data[2]);case "CLOSE_CHAT":return closeChat();case "GET_SESSION":return getSession(source);
case "GET_ARGS":return getArgs(source);case "SET_SESSION":return setSession(event.data[2]);case "SET_ARGS":return setArgs(event.data[2]);case "SET_TRANSFER":return setTransfer(event.data[2]);case "CLEAN_ENVIRONMENT":return cleanEnvironment();case "OPEN_CHAT":return openChat();case "MINIMIZE_CHAT":return minimizeChat(source,event.data[2]);case "FIT_CHAT":return fitChat(event.data[2]);case "FIT_MINIMIZED_CHAT":return fitMinimizedChat(source,event.data[2]);case "SHOW_MINIMIZED_SHADOW":return showMinimizedShadow();
case "NEW_MESSAGE":return newMessage(event.data[2]);case "TRANSFER_TO_INACTIVE_CAMPAIGN":return transferToInactiveCampaign(event.data[2]);case "CURRENT_FORM":return currentForm(event.data[2]);case "APP_MESSAGE":return appMessage(source,event.data[2]);case "SHOW_MINIMIZED_CHAT_RESPONSE":return self.__response("SHOW_MINIMIZED_CHAT_RESPONSE");case "HIDE_MINIMIZED_CHAT_RESPONSE":return self.__response("HIDE_MINIMIZED_CHAT_RESPONSE");case "SHOW_CHAT_RESPONSE":return self.__response("SHOW_CHAT_RESPONSE");
case "HIDE_CHAT_RESPONSE":return self.__response("HIDE_CHAT_RESPONSE");case "SEND_MESSAGE_TO_APP_RESPONSE":return self.__response("SEND_MESSAGE_TO_APP_RESPONSE",event.data[2]);case "ENABLE_SCREEN_SHARING":var params=event.data[2];var containerId=params.containerId+"_container";var enable=params.enable;if(enable){self.previousWidth=$("#"+containerId).css("width");self.previousHeight=$("#"+containerId).css("height");$("#"+containerId).css("width","95%");$("#"+containerId).css("height","100%")}else{$("#"+
containerId).css("width",self.previousWidth);$("#"+containerId).css("height",self.previousHeight)}return;case "ENABLE_GEOLOCATION":var params=event.data[2];var containerId=params.containerId+"_container";var enable=params.enable;if(enable==="SHOW"){if(!self.previousWinMapHeight&&!self.previousWinMapWidth){self.previousWinMapHeight=$("#"+containerId).css("height");self.previousWinMapWidth=$("#"+containerId).css("width")}if(!self.previousLeftPosition&&!self.previousRightPosition){self.previousLeftPosition=
$("#"+containerId).css("left");self.previousRightPosition=$("#"+containerId).css("right")}$("#"+containerId).css("height","100%");if(!mobile){$("#"+containerId).css("width","100%");$("#"+containerId).css("right","0px")}}else if(enable==="HIDE"||enable==="MIN")if(self.previousWinMapHeight&&self.previousWinMapWidth){$("#"+containerId).css("height",self.previousWinMapHeight);if(!mobile){$("#"+containerId).css("width",self.previousWinMapWidth);$("#"+containerId).css("right","5%")}if(enable==="MIN")$("#"+
containerId).css("width",($("#"+containerId).width()*2).toString()+"px");else{$("#"+containerId).css("width",self.previousWinMapWidth);self.previousWinMapHeight=null;self.previousWinMapWidth=null}}return}})};InConcertEvents.prototype.showMinimizedChat=function(callback){try{this.m_responseFunctions.SHOW_MINIMIZED_CHAT_RESPONSE.callback=callback;this.__notify(this.webchat.iframeButton.contentWindow,"SHOW_MINIMIZED_CHAT")}catch(e){}};InConcertEvents.prototype.hideMinimizedChat=function(callback){try{this.m_responseFunctions.HIDE_MINIMIZED_CHAT_RESPONSE.callback=
callback;this.__notify(this.webchat.iframeButton.contentWindow,"HIDE_MINIMIZED_CHAT")}catch(e){}};InConcertEvents.prototype.showChat=function(rejoin,callback){try{this.m_responseFunctions.SHOW_CHAT_RESPONSE.callback=callback;this.__notify(this.webchat.iframe.contentWindow,"SHOW_CHAT",rejoin)}catch(e){}};InConcertEvents.prototype.hideChat=function(callback){try{this.m_responseFunctions.HIDE_CHAT_RESPONSE.callback=callback;this.__notify(this.webchat.iframe.contentWindow,"HIDE_CHAT")}catch(e){}};InConcertEvents.prototype.closeChat=
function(){try{this.__notify(this.webchat.iframe.contentWindow,"DO_CLOSE_CHAT")}catch(e){}};InConcertEvents.prototype.notifyNewMessage=function(){try{this.__notify(this.webchat.iframeButton.contentWindow,"ON_NEW_MESSAGE")}catch(e){}};InConcertEvents.prototype.notifyMessagesReaded=function(){try{this.__notify(this.webchat.iframeButton.contentWindow,"ON_MESSAGES_READED")}catch(e){}};InConcertEvents.prototype.sendMessageToApp=function(data,callback){try{this.m_responseFunctions.SEND_MESSAGE_TO_APP_RESPONSE.callback=
callback;var message={data:data,callback:callback?true:false};this.__notify(this.webchat.iframe.contentWindow,"SEND_MESSAGE_TO_APP",message)}catch(e){}};function InConcertWebchat(){var token=getAccountToken(account);this.popup=null;this.$container=null;this.$button=null;this.$appButton=null;this.originalAccount=account;this.currentAccount=account;this.originalToken=token;this.currentToken=token;this.originalAddress=address;this.currentAddress=address;this.triggers=new InConcertTriggers(this);this.storage=
new InConcertStorage(this);this.server=new InConcertServer(this);this.events=new InConcertEvents(this,this.storage);this.experimental_ada_features_enabled=false}InConcertWebchat.prototype.__transformSize=function(size,vertical){return size};InConcertWebchat.prototype.moveContext=function(context){this.currentAccount=context.account;this.currentToken=getAccountToken(context.account);this.currentAddress=buildAddress(context.host,context.public_port,context.public_ssl_port)};InConcertWebchat.prototype.restoreContext=
function(){this.currentAccount=this.originalAccount;this.currentToken=this.originalToken;this.currentAddress=this.originalAddress};InConcertWebchat.prototype.gatherParameters=function(){var accountParameters=getAccountSnippetParameters(this.currentAccount);var parameters=[];for(var i=0;i<accountParameters.length;i++){var param=accountParameters[i];parameters[i]={v:$("#"+param.controlId).val()||"",t:param.type,a:param.alias,n:param.controlId};if(param.hidden)parameters[i].h=true}return parameters};
InConcertWebchat.prototype._minimize=function(callback,dontShowMinimized){this._maximized=false;this.storage.setMinimized(true);if(mobile)this.removeClass($("html, body"),"noScroll");var self=this;callback=callback||function(){};(function(callback){if(self.$container){self.$container.css({"-webkit-box-shadow":"none","-moz-box-shadow":"none","box-shadow":"none"});self._moveLockScreen(false);self.events.hideChat(function(){self._moveChatWindow(false);callback()})}else callback()})(function(){if(self.$button&&
!dontShowMinimized){self._moveStartButton(true);self.__showMinimizedChat(callback)}else if(self.$appButton){self.$appButton.removeClass("maximizedChat").addClass("minimizedChat");callback()}else callback()})};InConcertWebchat.prototype._maximizePopup=function(callback){this.popup.focus();callback()};InConcertWebchat.prototype.__showMinimizedChat=function(callback){var self=this;callback=callback||function(){};self.events.showMinimizedChat(function(){self.showMinimizedShadow();callback()})};InConcertWebchat.prototype.showMinimizedShadow=
function(){if(!this.$button||this._maximized&&!this.dontHideMinimizedChat)return;var shadowProperty="none";if(this.__minimizedShadow)shadowProperty="0px 0px "+(this.__minimizedShadow.size||12)+"px "+(this.__minimizedShadow.color||"#aaaaaa");this.$button.css({"-webkit-box-shadow":shadowProperty,"-moz-box-shadow":shadowProperty,"box-shadow":shadowProperty})};InConcertWebchat.prototype._maximizeEmbedded=function(callback){var self=this;var rejoin=self.rejoin;self.rejoin=false;(function(callback){if(self.$button)self.events.hideMinimizedChat(function(){if(!self.dontHideMinimizedChat)self.$button.css({"-webkit-box-shadow":"none",
"-moz-box-shadow":"none","box-shadow":"none"});callback()});else if(self.$appButton){self.$appButton.removeClass("minimizedChat").addClass("maximizedChat");callback()}else callback()})(function(){if(self.$container){self._moveChatWindow(true);self.events.showChat(rejoin,function(){self._moveLockScreen(true);var shadowProperty="none";if(self.__chatShadow)shadowProperty="0px 0px "+(self.__chatShadow.size||12)+"px "+(self.__chatShadow.color||"#aaaaaa");self.$container.css({"-webkit-box-shadow":shadowProperty,
"-moz-box-shadow":shadowProperty,"box-shadow":shadowProperty});if(self.$button&&self.dontHideMinimizedChat&&rejoin){self._moveStartButton(true);self.__showMinimizedChat(callback)}else{if(!self.dontHideMinimizedChat)self._moveStartButton(false);callback()}})}else callback()})};InConcertWebchat.prototype._maximize=function(callback){callback=callback||function(){};var self=this;if(self.rejoin&&self.storage.getMinimized()){self.rejoin=false;return self._minimize(callback)}self._maximized=true;self.storage.setMinimized(false);
if(mobile)this.addClass($("html, body"),"noScroll");function onMaximized(){self.onMessagesReaded();callback()}if(this.popup)this._maximizePopup(onMaximized);else if(this.iframe)this._maximizeEmbedded(onMaximized)};InConcertWebchat.prototype.closeChat=function(callback){var self=this;callback=callback||function(){};self.setContainerToNormalPosition();self._minimize(function(){self.$container.remove();self.iframe=null;self.$container=null;self.onMessagesReaded();callback();if(self.__onChatClosed)self.__onChatClosed()})};
InConcertWebchat.prototype.fitChat=function(configuration){var self=this;var css={};if(mobile){css.width=this.__transformSize("100%");css.height=this.__transformSize("100%",true);css.left="0px";css.right="";css.top="0px";css.bottom=""}else{css.width=this.__transformSize(configuration.size.width);css.height=this.__transformSize(configuration.size.height,true);css.left=this.__transformSize(configuration.position.left)||"";css.right=this.__transformSize(configuration.position.right)||"";css.top=this.__transformSize(configuration.position.top,
true)||"";css.bottom=this.__transformSize(configuration.position.bottom,true)||"";self.__chatShadow=configuration.shadow;configuration.round=configuration.round||{};css["border-top-left-radius"]=this.__transformSize(configuration.round["border-top-left-radius"],true)||"";css["border-top-right-radius"]=this.__transformSize(configuration.round["border-top-right-radius"],true)||"";css["border-bottom-left-radius"]=this.__transformSize(configuration.round["border-bottom-left-radius"],true)||"";css["border-bottom-right-radius"]=
this.__transformSize(configuration.round["border-bottom-right-radius"],true)||""}self.$container.css(css);if(configuration.lockWindow)self.lockWindow=configuration.lockWindow;else self.lockWindow=null;if(!self.$container.is(":visible"))self.$container.show(function(){self._maximize()});else self._maximize()};InConcertWebchat.prototype._moveStartButton=function(front,inactive){if(!this.$button)return;this.$button.css("z-index",front?!inactive&&this._active?MAX_ZINDEX-2:9997:MIN_ZINDEX+1)};InConcertWebchat.prototype._moveChatWindow=
function(front){this.$container.css("z-index",front?MAX_ZINDEX:MIN_ZINDEX+1)};InConcertWebchat.prototype._moveLockScreen=function(front){if(!this.$lockScreen)return;this.$lockScreen.css(this.lockWindow&&front?{"background":this.lockWindow.background||"black","opacity":this.lockWindow.opacity||"0.5","z-index":MAX_ZINDEX-1}:{"background":"transparent","opacity":"","z-index":MIN_ZINDEX})};InConcertWebchat.prototype.fitMinimizedChat=function(configuration,callback){var self=this;var open=self.rejoin?
-1:1;var css={};self.dontHideMinimizedChat=!!configuration.dontHide;self.__minimizedShadow=configuration.shadow;css.width=this.__transformSize(configuration.size.width);css.height=this.__transformSize(configuration.size.height,true);css.left=this.__transformSize(configuration.position.left)||"";css.right=this.__transformSize(configuration.position.right)||"";css.top=this.__transformSize(configuration.position.top,true)||"";css.bottom=this.__transformSize(configuration.position.bottom,true)||"";configuration.round=
configuration.round||{};css["border-top-left-radius"]=this.__transformSize(configuration.round["border-top-left-radius"],true)||"";css["border-top-right-radius"]=this.__transformSize(configuration.round["border-top-right-radius"],true)||"";css["border-bottom-left-radius"]=this.__transformSize(configuration.round["border-bottom-left-radius"],true)||"";css["border-bottom-right-radius"]=this.__transformSize(configuration.round["border-bottom-right-radius"],true)||"";if(configuration.scroll){css.position=
"absolute";if(self.__scrollHandle)$(window).unbind("scroll",self.__scrollHandle);self.__scrollHandle=function(){self.$button.stop(true,false).animate({"marginTop":$(window).scrollTop()+"px","marginLeft":$(window).scrollLeft()+"px"},configuration.scroll.duration)};$(window).scroll(self.__scrollHandle);self.__scrollHandle()}this.$button.css(css);if(configuration.resize)return callback(0);if(open>0)self._moveStartButton(true);if(self._active||(hasOutOfHoursAccount(this.originalAccount)||getAccountOutOfHoursProcess(this.originalAccount))&&
reasonInactiveCampaign!=="NOT_AGENTS")self.$button.show(function(){callback(open)});else console.log("Hidding start button because campaign is inactive and not out of hours process nor form has been configured.")};InConcertWebchat.prototype.onNewMessage=function(message){if(this.__onNewMessage)this.__onNewMessage(message);if(this._maximized)return;if(this.iframeButton)this.events.notifyNewMessage();else if(this.$appButton)this.$appButton.addClass("newMessages")};InConcertWebchat.prototype.onMessagesReaded=
function(){if(this.iframeButton)this.events.notifyMessagesReaded();else if(this.$appButton)this.$appButton.removeClass("newMessages")};InConcertWebchat.prototype.isOpen=function(){if(this.popup&&this.popup.length)return"POPUP";if(this.iframe)return"EMBED";return false};InConcertWebchat.prototype.__loadChatConfiguration=function(callback){var self=this;var tweetyAppName=getAccountTweetyAppName(self.currentAccount);var appVcc=tweetyAppName.indexOf("{")>=0?"system":vcc;var url=self.currentAddress+"/inconcert/apps/webdesigner/get_chat_first_form/"+
encodeURIComponent(appVcc)+"/"+encodeURIComponent(self.currentToken)+"/"+encodeURIComponent(tweetyAppName);$.ajax({url:url,type:"get",dataType:"jsonp",success:function(response){if(response.status)self.currentChatConfiguration=response.data.childs[0];callback(response.status)},error:function(){callback(false)}})};InConcertWebchat.prototype.initPopUpChat=function(url){var self=this;self.__loadChatConfiguration(function(status){var configuration=status&&self.currentChatConfiguration||{width:260,height:330};
var properties="menubar=no,"+"toolbar=no,"+"location=no,"+"resizable=yes,"+"scrollbars=no,"+"status=no,";if(!mobile){properties+="height="+configuration.height+","+"width="+configuration.width;var dualScreenLeft=window.screenLeft!==undefined?window.screenLeft:screen.left;var dualScreenTop=window.screenTop!==undefined?window.screenTop:screen.top;var width=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width;var height=window.innerHeight?
window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;switch(configuration.horizontalPosition){case "CENTER":var left=width/2-configuration.width/2+dualScreenLeft;properties+=",left="+left;break}switch(configuration.verticalPosition){case "CENTER":var top=height/2-configuration.height/2+dualScreenTop;properties+=",top="+top;break}}self.popup=window.open(url+"&type=popup","chat_window",properties)})};InConcertWebchat.prototype.initTabChat=function(url){var self=
this;self.__loadChatConfiguration(function(){self.popup=window.open(url+"&type=popup","_chat_window")})};InConcertWebchat.prototype.setContainerToFullScreen=function(){var self=this;var divId=self.currentToken+"_container";var dv=document.getElementById(divId);if(dv&&!dv.__full){dv.__full=true;setTimeout(function(){self.dv_style_data={};self.db_style_data={};self.dv_style_data["position"]=dv.style["position"];self.dv_style_data["width"]=dv.style["width"];self.dv_style_data["top"]=dv.style["top"];
self.dv_style_data["left"]=dv.style["left"];self.dv_style_data["right"]=dv.style["right"];self.dv_style_data["overflow"]=dv.style["overflow"];self.dv_style_data["bottom"]=dv.style["bottom"];self.dv_style_data["right"]=dv.style["right"];dv.style["position"]="absolute";dv.style["width"]="";dv.style["top"]="0px";dv.style["left"]="0px";dv.style["right"]="0px";dv.style["overflow"]="visible";self.db_style_data["overflow-x"]=document.body.style["overflow-x"];self.db_style_data["overflow-y"]=document.body.style["overflow-y"];
document.body.style["overflow-x"]="hidden";document.body.style["overflow-y"]="auto"},1E3)}};InConcertWebchat.prototype.setContainerToNormalPosition=function(){var self=this;var divId=self.currentToken+"_container";var dv=document.getElementById(divId);if(dv&&dv.__full){dv.style["position"]=self.dv_style_data["position"];dv.style["width"]=self.dv_style_data["width"];dv.style["top"]=self.dv_style_data["top"];dv.style["left"]=self.dv_style_data["left"];dv.style["right"]=self.dv_style_data["right"];dv.style["overflow"]=
self.dv_style_data["overflow"];dv.style["bottom"]=self.dv_style_data["bottom"];dv.style["right"]=self.dv_style_data["right"];document.body.style["overflow-x"]=self.db_style_data["overflow-x"];document.body.style["overflow-y"]=self.db_style_data["overflow-y"];dv.__full=false}};InConcertWebchat.prototype.initEmbeddedChat=function(url){var self=this;var divId=self.currentToken+"_container";var divStyle="display:none; position: fixed; z-index: "+(MIN_ZINDEX+1)+"; overflow: hidden;";var div='<div class="webchatContainer" id="'+
divId+'" style="'+divStyle+'">'+'<iframe width="100%" height="100%" style="border:none;" src="'+url+"&type=embedded"+'" scrolling="no" allow="autoplay;camera;microphone;display-capture;geolocation" ></iframe>'+"</div>";if(self.experimental_ada_features_enabled)self.zoom_check_interval=setInterval(function(){var zoomLevel=Math.round((window.devicePixelRatio||1)*100);var zoomLevelThreshold=300;if(zoomLevel<zoomLevelThreshold)self.setContainerToNormalPosition();else self.setContainerToFullScreen()},
100);$("#"+divId).remove();$("body").append(div);self.$container=$("#"+divId);self.iframe=self.$container.find("iframe")[0];var lockDivId=self.currentToken+"_lockScreen";var lockDivStyle="position: fixed; z-index: "+(MIN_ZINDEX+1)+"; overflow:hidden; "+"left: 0px; top: 0px; "+"width: "+this.__transformSize("100%")+"; height: "+this.__transformSize("100%",true);var lockDivHtml='<div class="webchatLockScreen" id="'+lockDivId+'" style="'+lockDivStyle+'">';$("#"+lockDivId).remove();$("body").append(lockDivHtml);
self.$lockScreen=$("#"+lockDivId)};InConcertWebchat.prototype.initChat=function(initialContext,transferContext,rejoin){var self=this;if(!self._active)return self.initOutOfHours();if(self.isOpen())return self._maximize();self.triggers.disableTriggers();if(initialContext)self.restoreContext();var type=getAccountWindowType(self.originalAccount);var tweetyAppName=getAccountTweetyAppName(self.currentAccount);var url=self.currentAddress+"/inconcert/apps/webdesigner/"+encodeURIComponent(tweetyAppName)+"?token="+
encodeURIComponent(self.currentToken)+"&notify="+encodeURIComponent(self.events._uuid)+"&dev="+(isDev?"true":"false");if(mobile)url+="&mobile=true";if(hasAccountGoogle(self.currentAccount))url+="&google_key="+encodeURIComponent(getAccountGoogleKey(self.currentAccount))+"&google_bysections="+encodeURIComponent(getAccountGoogleBySections(self.currentAccount));var gatheredParameters=self.gatherParameters();function __initChat(){if(gatheredParameters.length>0)url+="&params="+encodeURIComponent(JSON.stringify(gatheredParameters));
if(transferContext&&transferContext.interactionId){url+="&transferrer_id="+encodeURIComponent(transferContext.interactionId);if(rejoin&&hasToGoChatIfTransfer(self.currentAccount))url+="&go_chat=true"}switch(type){case "popup":self.initPopUpChat(url);break;case "tab":self.initTabChat(url);break;default:self.initEmbeddedChat(url)}if(this.__onChatOpen)this.__onChatOpen(!!rejoin)}if(!rejoin&&this.__captureFunction)if(this.__captureFncAsync)this.__captureFunction(function(newParameters){try{$.each(newParameters,
function(_,parameter){gatheredParameters.push(parameter)})}catch(e){}__initChat()});else{try{var newParameters=this.__captureFunction();$.each(newParameters,function(_,parameter){gatheredParameters.push(parameter)})}catch(e){}__initChat()}else __initChat()};InConcertWebchat.prototype.initOutOfHours=function(){if(!this.$webcontactButton)return;this.$webcontactButton.click()};InConcertWebchat.prototype.__showMinimized=function(){this.triggers.disableTriggers();this._minimize()};InConcertWebchat.prototype.configureWebappStartButton=
function(){var self=this;var tweetyAppName=getAccountTweetyAppName(self.originalAccount);var url=this.originalAddress+"/inconcert/apps/webdesigner/"+encodeURIComponent(tweetyAppName)+".___start_minimized"+"?token="+encodeURIComponent(this.originalToken)+"&notify="+encodeURIComponent(self.events._uuid)+"&dev="+(isDev?"true":"false");if(mobile)url+="&mobile=true";if(!self._active){url+="&outOfHours=true";if(!hasOutOfHoursAccount(this.originalAccount))url+="&inactive=true"}var divId=self.originalToken+
"_startButtonContainer";var divStyle="display:none; position: fixed; z-index: "+(MIN_ZINDEX+1)+"; overflow: hidden;";var div='<div class="webchatStartButtonContainer" id="'+divId+'" style="'+divStyle+'">'+'<iframe width="100%" height="100%" style="border:none;" src="'+url+'" scrolling="no" allowTransparency="true" ></iframe>'+"</div>";$("#"+divId).remove();$("body").append(div);self.$button=$("#"+divId);self.iframeButton=self.$button.find("iframe")[0]};InConcertWebchat.prototype.configurePageStartButton=
function(){var self=this;self.$appButton=$("#"+getAccountContainerId(self.originalAccount));self.$appButton.click(function(e){self.initChat(true);e.preventDefault();return false});if(!self._active)self.$appButton.addClass("outOfHours")};InConcertWebchat.prototype.configureStartButton=function(){if(getAccountStartButton(this.originalAccount)==="app")this.configureWebappStartButton();else this.configurePageStartButton()};InConcertWebchat.prototype.makeAPI=function(){var self=this;if(!window.hasOwnProperty("inConcert"))window.inConcert=
{};window.inConcert[this.originalToken]={isActive:function(){return!!self._active},isOpen:function(){return!!self.isOpen()},isMaximized:function(){return!!self._maximized},isTransferred:function(){return!!(self.isOpen()&&self.originalToken!==self.currentToken)},getMode:function(){return getAccountWindowType(self.originalAccount)},getCurrentToken:function(){return self.currentToken},getCurrentForm:function(){return self.isOpen()?self._currentForm:null},openChat:function(){self.initChat(true)},closeChat:function(){if(!self.isOpen())return;
self.events.closeChat()},minimizeChat:function(){if(!self.isOpen())return;self._minimize()},maximizeChat:function(){if(!self.isOpen())return;self._maximize()},disableTriggers:function(){self.triggers.disableTriggers()},getTriggers:function(){return self.triggers.triggers},setTriggers:function(triggers){self.triggers.triggers=triggers},setCaptureParametersFunction:function(captureFunction,async){self.__captureFunction=captureFunction;self.__captureFncAsync=!!async},onChatOpen:function(fn){self.__onChatOpen=
fn},onChatClosed:function(fn){self.__onChatClosed=fn},onNewMessage:function(fn){self.__onNewMessage=fn},onTransfer:function(fn){self.__onTransfer=fn},onLoginForm:function(fn){self.__onLoginForm=fn},onPreSurveyForm:function(fn){self.__onPreSurveyForm=fn},onChatForm:function(fn){self.__onChatForm=fn},onPostSurveyForm:function(fn){self.__onPostSurveyForm=fn},onAppMessage:function(fn){self.__onAppMessage=fn},sendMessageToApp:function(data,callback){self.events.sendMessageToApp(data,callback)}}};InConcertWebchat.prototype.loadActiveChat=
function(){this.events.listen();this.triggers.startTriggers();this.makeAPI();readyActiveChat()};InConcertWebchat.prototype.transferToInactiveCampaign=function(account){var self=this;self.restoreContext();self.loadWebcontact(account,function(){self.closeChat(function(){self._moveStartButton(true,true);self.initOutOfHours()})})};InConcertWebchat.prototype.loadWebcontact=function(account,callback){var self=this;account=account||this.originalAccount;var webcontactToken=getOutOfHoursAccount(account);var id=
this.originalToken+"_outOfHours";var url=this.server.getWebcontactUrl()+"/click_to_contact?token="+encodeURIComponent(webcontactToken)+"&container_id="+encodeURIComponent(id)+"&dev="+(isDev?"true":"false");var snippet="<div id='"+id+"' style='display:none;'></div>"+"<script type='text/javascript'>\n"+"(function() {\n"+"var proto  = document.location.protocol || 'http:';\n"+"var node   = document.createElement('script');\n"+"node.type  = 'text/javascript';\n"+"node.async = true;\n"+"node.src   = proto +  '"+
url+"';\n"+"var s = document.getElementsByTagName('script')[0];\n"+"s.parentNode.insertBefore(node, s);\n"+"})();\n"+"\x3c/script>\n";$("body").append(snippet);(function wait(){if(!$("#"+id+" a").length)return window.setTimeout(wait,100);self.$webcontactButton=$("#"+id+" a");callback()})()};InConcertWebchat.prototype.loadInactiveChat=function(){var self=this;this.events.listen();this.makeAPI();if(!hasOutOfHoursAccount(this.originalAccount)||reasonInactiveCampaign==="NOT_AGENTS"){this.configureStartButton();
return}this.loadWebcontact(this.originalAccount,function(){self.configureStartButton()})};InConcertWebchat.prototype.tryRejoin=function(callback){var self=this;function onFail(token){self.storage.cleanEnvironment(null,true);if(token&&token!==self.currentToken)self.storage.cleanEnvironment(token);callback(false)}function onSuccess(){callback(true)}function processRejoin(account,transferContext){var accountId=getAccountId(account);var token=getAccountToken(account);var sessionId=self.storage.getSession(token);
if(!sessionId)return onFail(token);self.server.checkActiveSession(accountId,sessionId,function(active){if(!active)return onFail(token);if(transferContext)self.moveContext(transferContext);self.initChat(false,transferContext,true);onSuccess()})}var transfer=self.storage.getTransfer();if(transfer)self.server.getAccountConfiguration(transfer.campaignId,transfer.accountId,function(context){if(!context)return onFail();context.interactionId=transfer.interactionId;processRejoin(context.account,context)});
else processRejoin(self.currentAccount)};InConcertWebchat.prototype.addClass=function($element,rule){$element.addClass(rule+"_"+this.originalToken)};InConcertWebchat.prototype.removeClass=function($element,rule){$element.removeClass(rule+"_"+this.originalToken)};InConcertWebchat.prototype.initCssRules=function(){initCssRules(this.originalToken);addCssRule(this.originalToken,".noScroll","position: fixed!important; overflow: hidden!important; width: 100%!important; height: 100%!important; margin: 0px!important;")};
InConcertWebchat.prototype.init=function(){var self=this;self.initCssRules();self.server.checkIsCampaignActive(function(active){self._active=active;if(!active){self.loadInactiveChat();return}self.loadActiveChat();self.tryRejoin(function(rejoin){self.rejoin=rejoin;self.configureStartButton()})})};var webchat=new InConcertWebchat;$(document).ready(function(){webchat.init()})};var checker=function(){if("jQuery"in global)if(jQuery&&jQuery.fn&&jQuery.fn.jquery>="3")return true;if("$inconcert"in global)return true;
return false};if(window.hasOwnProperty("$inconcert"))got_jquery($inconcert);else if(checker())got_jquery(jQuery);else{(function(){var node=document.createElement("script");node.type="text/javascript";node.async=true;node.src=address+"/inconcert/apps/webdesigner/lib/jquery/jquery-3.6.0.min.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(node,s)})();var intId=setInterval(function(){if(checker()){clearInterval(intId);got_jquery($inconcert)}},100)}})(this);
